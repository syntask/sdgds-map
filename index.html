<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset='utf-8'>
    <meta name="viewport" content="initial-scale=1,width=device-width,viewport-fit=cover" />

    <!-- Import MapLibre GL JS -->
    <link rel='stylesheet' href='https://unpkg.com/maplibre-gl@4.3.2/dist/maplibre-gl.css' />
    <script src='https://unpkg.com/maplibre-gl@4.3.2/dist/maplibre-gl.js'></script>

    <!-- Import MapTiler Geocoding Control -->
    <script src="https://unpkg.com/@maptiler/geocoding-control@latest/maplibregl.umd.js"></script>
    <link href="https://unpkg.com/@maptiler/geocoding-control@latest/style.css" rel="stylesheet" />

    <!-- Import Turf.js -->
    <script src="https://unpkg.com/@turf/turf@latest"></script>

    <style>

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        .maplibregl-ctrl-attrib.maplibregl-compact {
            margin: 20px;
        }

        .maplibregl-ctrl-top-left .maplibregl-ctrl {
            margin: 20px 0 0 20px;
        }

        .maplibregl-ctrl-geocoder form {
            border-radius: 12px !important;
        }

        .maplibregl-ctrl-geocoder form div {
            padding: 8px;
            border-radius: 12px !important;
        }

    </style>
</head>
<body>
    <div id="map"></div>
    <script>

        // MARK: - Global variables
        const API_KEY = 'uxGPO18AyvxUdEGKe02K';
        const style = 'https://api.maptiler.com/maps/streets-v2/style.json';
        const center = [-111.79, 33.425];


        // MARK: - Map initializer
        const map = new maplibregl.Map({
            container: 'map',
            style: style + '?key=' + API_KEY,
            center: center,
            zoom: 9.5,
            TerrainControl: false,
            interactive: false,
        });


        map.on('load', function() {

            map.dragPan.disable(); // Prevent scroll interuption on mobile
            map.scrollZoom.disable(); // Prevent zoom interuption on desktop
            
            // Service area data
            map.addSource('maine', {
                'type': 'geojson',
                'data': {
                    'type': 'Feature',
                    'geometry': {
                        'type': 'Polygon',
                        'coordinates': [[[-112.032331, 32.830886], [-112.032359, 32.830322], [-112.121864, 32.833879], [-112.122359, 32.829565], [-112.135002, 32.829565], [-112.141652, 32.833796], [-112.186218, 32.835316], [-112.203317, 32.836211], [-112.203258, 32.875065], [-112.203736, 32.941736], [-112.202798, 32.941719], [-112.203105, 33.015258], [-112.210301, 33.014502], [-112.271077, 33.014567], [-112.271721, 33.01395], [-112.27175, 32.988405], [-112.272425, 32.985577], [-112.287531, 32.985532], [-112.288437, 32.988405], [-112.301149, 32.992883], [-112.302421, 32.997235], [-112.3003, 33.012022], [-112.300753, 33.014678], [-112.306373, 33.01478], [-112.306376, 33.043785], [-112.315002, 33.044483], [-112.271751, 33.055432], [-112.27193, 33.065421], [-112.263195, 33.06317], [-112.262805, 33.057698], [-112.228678, 33.066318], [-112.228722, 33.087092], [-112.237294, 33.087134], [-112.237286, 33.072564], [-112.271783, 33.072908], [-112.271771, 33.108964], [-112.269888, 33.110717], [-112.254547, 33.112765], [-112.254548, 33.116072], [-112.204471, 33.116311], [-112.202045, 33.117804], [-112.201788, 33.132537], [-112.202361, 33.158268], [-112.201965, 33.207293], [-112.202163, 33.246862], [-112.250684, 33.246468], [-112.306184, 33.246921], [-112.30615, 33.362626], [-112.306058, 33.378672], [-112.309112, 33.379883], [-112.30232, 33.383015], [-112.294547, 33.379965], [-112.288518, 33.379291], [-112.280405, 33.381467], [-112.271541, 33.381259], [-112.254295, 33.38384], [-112.254288, 33.3918], [-112.24573, 33.391855], [-112.245389, 33.395499], [-112.237019, 33.395425], [-112.236982, 33.400146], [-112.238621, 33.422992], [-112.238231, 33.437151], [-112.22124, 33.437321], [-112.221152, 33.451777], [-112.238325, 33.451801], [-112.238146, 33.462964], [-112.237989, 33.465335], [-112.272537, 33.464733], [-112.272444, 33.493799], [-112.312825, 33.493133], [-112.306577, 33.507539], [-112.308612, 33.51484], [-112.308968, 33.521616], [-112.317148, 33.522699], [-112.32712, 33.522078], [-112.328101, 33.52935], [-112.347138, 33.530021], [-112.35815, 33.529797], [-112.358913, 33.551305], [-112.358985, 33.571286], [-112.350443, 33.571255], [-112.350451, 33.565675], [-112.341858, 33.565608], [-112.341832, 33.55855], [-112.349915, 33.558473], [-112.349883, 33.552827], [-112.346023, 33.551204], [-112.324365, 33.551015], [-112.324447, 33.565467], [-112.311497, 33.565435], [-112.307179, 33.565372], [-112.306758, 33.550823], [-112.274461, 33.551322], [-112.237792, 33.552175], [-112.235615, 33.559296], [-112.224746, 33.559507], [-112.224746, 33.555912], [-112.220411, 33.552626], [-112.211745, 33.552799], [-112.211618, 33.560365], [-112.207286, 33.559969], [-112.202928, 33.56172], [-112.202801, 33.583949], [-112.202709, 33.596216], [-112.202622, 33.610607], [-112.202486, 33.625059], [-112.202724, 33.635837], [-112.207239, 33.638274], [-112.237789, 33.638157], [-112.237676, 33.652637], [-112.235804, 33.653473], [-112.234853, 33.66047], [-112.223409, 33.679349], [-112.223176, 33.681688], [-112.223178, 33.681733], [-112.220437, 33.689154], [-112.220047, 33.696175], [-112.203065, 33.696276], [-112.203134, 33.712285], [-112.203088, 33.745106], [-112.20354, 33.7519], [-112.201677, 33.764769], [-112.203179, 33.774441], [-112.20632, 33.776414], [-112.205951, 33.797813], [-112.169412, 33.798301], [-112.169629, 33.806544], [-112.167686, 33.811455], [-112.170414, 33.813892], [-112.173281, 33.838297], [-112.174566, 33.842223], [-112.187029, 33.842335], [-112.195779, 33.848454], [-112.166993, 33.848581], [-112.152325, 33.849052], [-112.15218, 33.856657], [-112.171793, 33.85663], [-112.171507, 33.86142], [-112.16811, 33.863017], [-112.164272, 33.86908], [-112.158604, 33.87101], [-112.152233, 33.871128], [-112.152303, 33.876934], [-112.146801, 33.877992], [-112.147164, 33.88389], [-112.143521, 33.883845], [-112.143531, 33.878426], [-112.134685, 33.878389], [-112.134685, 33.870996], [-112.100287, 33.871601], [-112.03059, 33.871651], [-112.030453, 33.812079], [-112.021609, 33.801966], [-112.021568, 33.799128], [-111.995684, 33.799091], [-111.995441, 33.747686], [-112.008376, 33.726493], [-111.977496, 33.726576], [-111.978132, 33.741139], [-111.968942, 33.741126], [-111.960744, 33.731804], [-111.960622, 33.741116], [-111.934683, 33.741201], [-111.934611, 33.748441], [-111.938968, 33.748442], [-111.93895, 33.755707], [-111.934584, 33.755686], [-111.934668, 33.788376], [-111.945474, 33.788517], [-111.947624, 33.784763], [-111.955344, 33.783608], [-111.960705, 33.784681], [-111.960816, 33.799176], [-111.92809, 33.799288], [-111.92713, 33.806553], [-111.916559, 33.806816], [-111.908429, 33.813793], [-111.891177, 33.813834], [-111.874017, 33.813859], [-111.87387, 33.824939], [-111.886381, 33.821008], [-111.891245, 33.820989], [-111.891382, 33.85728], [-111.89162, 33.890947], [-111.891256, 33.900196], [-111.839131, 33.900393], [-111.838988, 33.876298], [-111.834748, 33.868165], [-111.834042, 33.859539], [-111.830308, 33.86084], [-111.828368, 33.866165], [-111.825043, 33.86785], [-111.821562, 33.874895], [-111.816344, 33.877389], [-111.816022, 33.881592], [-111.820226, 33.890804], [-111.818361, 33.89552], [-111.821748, 33.896446], [-111.825649, 33.901551], [-111.819645, 33.905572], [-111.81642, 33.909394], [-111.817652, 33.914272], [-111.815774, 33.925578], [-111.817267, 33.93308], [-111.823123, 33.938939], [-111.82616, 33.945993], [-111.831164, 33.950022], [-111.830091, 33.953849], [-111.834576, 33.956322], [-111.839647, 33.956654], [-111.848784, 33.961595], [-111.85696, 33.963578], [-111.86286, 33.96233], [-111.86915, 33.978475], [-111.873714, 33.983722], [-111.872365, 33.98865], [-111.873045, 33.99628], [-111.87483, 34.00075], [-111.882047, 34.004782], [-111.879665, 34.009133], [-111.874652, 34.016516], [-111.874238, 34.016466], [-111.787024, 34.0068], [-111.787112, 33.900495], [-111.785953, 33.900495], [-111.786868, 33.813891], [-111.743621, 33.813881], [-111.745212, 33.807804], [-111.74094, 33.802384], [-111.72608, 33.798222], [-111.719075, 33.801627], [-111.713696, 33.802132], [-111.701355, 33.79807], [-111.693489, 33.792569], [-111.684868, 33.795275], [-111.691021, 33.801172], [-111.686428, 33.802377], [-111.683328, 33.799227], [-111.670431, 33.799824], [-111.666941, 33.800884], [-111.660421, 33.793198], [-111.663745, 33.789994], [-111.663137, 33.786007], [-111.657407, 33.786998], [-111.651782, 33.783449], [-111.652978, 33.779838], [-111.663428, 33.77533], [-111.663843, 33.771876], [-111.669523, 33.76549], [-111.674025, 33.758339], [-111.679929, 33.758755], [-111.680836, 33.756159], [-111.700322, 33.756], [-111.700159, 33.777659], [-111.717464, 33.777707], [-111.717519, 33.732487], [-111.726207, 33.733884], [-111.726219, 33.730236], [-111.717519, 33.726778], [-111.683522, 33.726949], [-111.683404, 33.709754], [-111.68883, 33.70889], [-111.695158, 33.665467], [-111.69855, 33.640491], [-111.701618, 33.619314], [-111.704697, 33.593939], [-111.70547, 33.593785], [-111.708372, 33.567492], [-111.738438, 33.567548], [-111.770065, 33.567948], [-111.787055, 33.567454], [-111.821685, 33.56789], [-111.822273, 33.552085], [-111.822152, 33.538744], [-111.804671, 33.538626], [-111.804848, 33.509718], [-111.78743, 33.509769], [-111.779513, 33.510945], [-111.774701, 33.513077], [-111.768971, 33.510779], [-111.762185, 33.511581], [-111.757109, 33.515814], [-111.751016, 33.512534], [-111.752818, 33.509349], [-111.752733, 33.494674], [-111.787468, 33.493862], [-111.787475, 33.489078], [-111.787477, 33.484278], [-111.76079, 33.484921], [-111.744352, 33.485158], [-111.740628, 33.481836], [-111.735124, 33.487861], [-111.728672, 33.486258], [-111.724045, 33.490377], [-111.723152, 33.493451], [-111.709606, 33.505533], [-111.702133, 33.50786], [-111.696687, 33.511871], [-111.693935, 33.517183], [-111.682742, 33.515608], [-111.675069, 33.52024], [-111.671059, 33.528346], [-111.672489, 33.537591], [-111.671754, 33.541455], [-111.661782, 33.546917], [-111.652082, 33.54929], [-111.644976, 33.549014], [-111.633394, 33.555493], [-111.622939, 33.554743], [-111.619474, 33.558242], [-111.613856, 33.560579], [-111.608882, 33.559449], [-111.60632, 33.556684], [-111.605895, 33.551374], [-111.603519, 33.548914], [-111.592912, 33.549407], [-111.588631, 33.555047], [-111.581562, 33.557993], [-111.573506, 33.554389], [-111.557486, 33.551485], [-111.546956, 33.5545], [-111.539765, 33.558681], [-111.540187, 33.561842], [-111.544217, 33.566277], [-111.544655, 33.570152], [-111.540961, 33.576965], [-111.53443, 33.575424], [-111.52858, 33.575558], [-111.522072, 33.573781], [-111.523038, 33.569198], [-111.519008, 33.563766], [-111.512573, 33.558363], [-111.504025, 33.556384], [-111.496545, 33.560191], [-111.495601, 33.562231], [-111.500325, 33.567552], [-111.496866, 33.570525], [-111.490954, 33.579422], [-111.480879, 33.569947], [-111.482126, 33.559976], [-111.475676, 33.558193], [-111.467003, 33.562856], [-111.462344, 33.563627], [-111.458185, 33.555512], [-111.448856, 33.557229], [-111.435816, 33.549808], [-111.433306, 33.546473], [-111.436482, 33.544677], [-111.430076, 33.537163], [-111.441513, 33.539054], [-111.447529, 33.545037], [-111.454246, 33.537277], [-111.453851, 33.524509], [-111.458209, 33.517761], [-111.455556, 33.510142], [-111.458002, 33.50416], [-111.461819, 33.501762], [-111.461212, 33.498717], [-111.464503, 33.495914], [-111.467592, 33.484883], [-111.472483, 33.48039], [-111.480144, 33.46586], [-111.442165, 33.465898], [-111.375684, 33.465894], [-111.26976, 33.465538], [-111.269897, 33.442014], [-111.269016, 33.376056], [-111.268867, 33.302762], [-111.26895, 33.280521], [-111.268934, 33.278318], [-111.251025, 33.278278], [-111.250969, 33.269653], [-111.254351, 33.264924], [-111.264491, 33.262982], [-111.2688, 33.260367], [-111.268942, 33.234083], [-111.253327, 33.228496], [-111.245013, 33.221756], [-111.237106, 33.218809], [-111.230953, 33.219839], [-111.222278, 33.204907], [-111.227046, 33.202036], [-111.236412, 33.20237], [-111.24402, 33.201444], [-111.249632, 33.195968], [-111.255355, 33.193771], [-111.265174, 33.193742], [-111.284087, 33.191049], [-111.299213, 33.191388], [-111.29582, 33.196987], [-111.296538, 33.201441], [-111.305337, 33.205962], [-111.319225, 33.205959], [-111.298406, 33.232591], [-111.322372, 33.244343], [-111.328721, 33.240772], [-111.342844, 33.2391], [-111.341148, 33.25002], [-111.338836, 33.255284], [-111.341254, 33.256687], [-111.350022, 33.266168], [-111.386463, 33.292764], [-111.438602, 33.292744], [-111.433397, 33.294935], [-111.425016, 33.296487], [-111.418624, 33.300213], [-111.4185, 33.30424], [-111.412046, 33.307525], [-111.459484, 33.307118], [-111.459402, 33.344632], [-111.471038, 33.340093], [-111.476986, 33.340427], [-111.482139, 33.338724], [-111.491363, 33.340882], [-111.49575, 33.338918], [-111.503813, 33.339177], [-111.509887, 33.335075], [-111.515109, 33.334452], [-111.520365, 33.336309], [-111.522319, 33.339537], [-111.508078, 33.342898], [-111.502718, 33.35045], [-111.512297, 33.349375], [-111.544559, 33.35073], [-111.563395, 33.350991], [-111.563376, 33.320252], [-111.57747, 33.329544], [-111.583782, 33.336641], [-111.583195, 33.277383], [-111.582683, 33.218888], [-111.582786, 33.20558], [-111.581303, 33.184237], [-111.585663, 33.179043], [-111.585759, 33.175865], [-111.580552, 33.17168], [-111.578191, 33.139922], [-111.573947, 33.139922], [-111.573513, 33.132661], [-111.57766, 33.132601], [-111.57726, 33.118167], [-111.661044, 33.117826], [-111.686032, 33.117659], [-111.68603, 33.146146], [-111.685629, 33.188872], [-111.686035, 33.204637], [-111.750504, 33.204751], [-111.780846, 33.204689], [-111.805715, 33.204696], [-111.832803, 33.204118], [-111.822429, 33.194937], [-111.791669, 33.169015], [-111.813105, 33.168675], [-111.804954, 33.161161], [-111.797877, 33.161161], [-111.795409, 33.1563], [-111.789224, 33.152498], [-111.789239, 33.146627], [-111.815041, 33.146627], [-111.814996, 33.161164], [-111.823686, 33.161181], [-111.823653, 33.153114], [-111.833396, 33.157649], [-111.840913, 33.159475], [-111.840906, 33.153517], [-111.833984, 33.150304], [-111.829345, 33.14667], [-111.830099, 33.143745], [-111.823838, 33.141381], [-111.815614, 33.136615], [-111.797914, 33.132904], [-111.797894, 33.128827], [-111.789201, 33.124516], [-111.789234, 33.117202], [-111.805161, 33.115707], [-111.808382, 33.119759], [-111.812903, 33.120502], [-111.82071, 33.125051], [-111.823728, 33.117714], [-111.827439, 33.11396], [-111.835263, 33.113206], [-111.824557, 33.102393], [-111.823666, 33.093857], [-111.830515, 33.102789], [-111.842704, 33.105235], [-111.853113, 33.106312], [-111.861102, 33.106192], [-111.882337, 33.102883], [-111.896961, 33.096828], [-111.913935, 33.084842], [-111.923809, 33.079757], [-111.926917, 33.076237], [-111.935205, 33.066125], [-111.915512, 33.065627], [-111.885034, 33.047978], [-111.89274, 33.04197], [-111.898447, 33.033341], [-111.902879, 33.012979], [-111.912051, 33.013363], [-111.91231, 32.973447], [-111.929049, 32.98254], [-111.945009, 32.99287], [-111.955781, 32.999232], [-111.997014, 32.999313], [-112.013721, 33.000014], [-112.013697, 32.996629], [-112.023598, 32.996504], [-112.023371, 32.982126], [-112.030732, 32.982146], [-112.03077, 32.96414], [-112.013761, 32.964181], [-111.996764, 32.962313], [-111.996805, 32.955812], [-111.996886, 32.939402], [-111.997746, 32.935719], [-111.997711, 32.87933], [-112.03205, 32.879323], [-112.031913, 32.850171], [-112.032331, 32.830886]]]
                    }
                }
            });

            // Service area fill layer
            map.addLayer({
                'id': 'maine',
                'type': 'fill',
                'source': 'maine',
                'layout': {},
                'paint': {
                    'fill-color': '#0092ff',
                    'fill-opacity': 0.4
                }
            }, "Road labels"); // Render underneath map labels

            // Service area outline layer
            map.addLayer({
                'id': 'maine-outline',
                'type': 'line',
                'source': 'maine',
                'layout': {
                    'line-join': 'round',
                    'line-cap': 'round'
                },
                'paint': {
                    'line-color': '#0092ff',
                    'line-width': 3,
                    'line-dasharray': [1, 2]
                }
            }, "Road labels"); // Render underneath map labels


            // MARK: - Geocoder initializer
            const gc = new maplibreglMaptilerGeocoder.GeocodingControl({
                apiKey: API_KEY,
                maplibregl,
                country: 'us',
                noResultsMessage: 'No results found.',
                placeholder: `Check if you're in our service area`,
                types: ['address'],
                proximity: [-111.79, 33.425],
                zoom: 18,
                showPlaceType: 'false',
                showFullGeometry: false

            });
        
            map.addControl(gc, 'top-left');


            // MARK: - Geocoder reset button event listener
            document.querySelector('.svelte-bz0zu3').addEventListener('click', function() {

                const marker = document.querySelector('.maplibregl-marker');
                if (marker) {
                    marker.remove();
                }

                resetView();

            });


            // MARK: - Geocoder event listener
            gc.on('pick', function (e) {

                try {

                    const coords = e.feature.geometry.coordinates;
                    const polygon = map.getSource('maine')._data.geometry.coordinates[0];
                    const point = turf.point(coords);
                    const polygonFeature = turf.polygon([polygon]);
                    const isInside = turf.booleanPointInPolygon(point, polygonFeature);
        
                    if (isInside) {

                        const marker = document.querySelector('.maplibregl-marker');
                        const message = document.createElement('div');
                        message.innerHTML = 'You are within our service area.';
                        message.style.color = '#000000';
                        message.style.fontSize = '1.2em';
                        message.style.backgroundColor = '#FFFFFF';
                        message.style.padding = '8px';
                        message.style.borderRadius = '12px';

                        marker.appendChild(message);

                        marker.style.display = 'flex';
                        marker.style.flexDirection = 'column';
                        marker.style.alignItems = 'center';
                        marker.style.justifyContent = 'center';

                    } else {

                        const marker = document.querySelector('.maplibregl-marker');
                        const message = document.createElement('div');
                        message.innerHTML = 'You are outside our service area.';
                        message.style.color = '#FFFFFF';
                        message.style.fontSize = '1.2em';
                        message.style.backgroundColor = '#FF0000';
                        message.style.padding = '8px';
                        message.style.borderRadius = '12px';

                        marker.appendChild(message);

                        marker.style.display = 'flex';
                        marker.style.flexDirection = 'column';
                        marker.style.alignItems = 'center';
                        marker.style.justifyContent = 'center';

                    }

                } catch (e) {

                    console.log('Error:', e);

                }

            });


            // Helper function to reset the map view to the service area
            function resetView() {
                const bounds = new maplibregl.LngLatBounds();
                const coordinates = map.getSource('maine')._data.geometry.coordinates[0];
                coordinates.forEach(function (coordinate) {
                    bounds.extend(coordinate);
                });
                map.fitBounds(bounds, {
                    padding: 40
                });
            }

            resetView();

            // Collapse the attribution control on load
            const attrib = document.querySelector('.maplibregl-ctrl-attrib');
            attrib.classList.remove('maplibregl-compact-show');
            attrib.attributes.removeNamedItem('show');


        });
        


    </script>
</body>
</html>
